---
title: Migrate Applications to TEE
nav_order: 3
---

# üêù Migrate Applications to TEE

This section will not cover how to containerize your application with Docker. Instead, we assume you have already done so and have tested it locally to ensure all functionalities work well. Our focus here is to demonstrate how to migrate your application into a TEE, ensuring it remains accessible and providing TEE Proof so you can verify its integrity to anyone interested.

### Expose Service Port

In Docker, you can specify the **HTTP ports** you want to expose by [**configuring port publishing**](https://docs.docker.com/get-started/docker-concepts/running-containers/publishing-ports/#publishing-ports) using the format **HOST_PORT:CONTAINER_PORT**. This configuration forwards requests sent to **HOST_PORT** to the container‚Äôs program listening on **CONTAINER_PORT**.

When deploying your Docker program to Phala TEE Cloud, the process remains the same. You should specify the port mapping in the Docker Compose file using the **ports** field, as shown below:

```yaml
services:
  web:
    build: .
    ports:
      - "80:8000"
  db:
    image: postgres
    ports:
      - "8001:5432"
```

After deployment, you will see two public endpoints on the dashboard. These URLs can be used to publicly access the service running in Docker. Behind the scenes, our cloud platform parses the Docker Compose file and automatically configures the network forwarding.

![network-page](/imgs/network-page.png)

**üéâ Congratulations! You've successfully deployed your application into a TEE. If you're interested in learning more, such as how to prove your application's integrity to others or manage application logs, keep reading.**

### Generate RA Report Inside the Container

The cloud will generate a default RA report for your application when it is bootstrapped. You can view this report on the dashboard under the **Attestation** tab and verify it by clicking the **Check** **Attestation** button.

![cert-chain](/imgs/cert-chain.png)

To generate a new RA report, rather than using the default one, which allows you to prove the execution of your code, you first need to mount the Dstack API socket file to the container by configuring **volumes** in the Docker Compose file.

```yaml
services:
  web:
    image: quay.io/jupyter/base-notebook
    volumes:
      - /var/run/tappd.sock:/var/run/tappd.sock
```

In your application, you can generate the RA report using the [Dstack guest SDK](https://github.com/Dstack-TEE/dstack/tree/master/sdk), which supports Python, JS, and Go. The `user-data` field allows you to attach your own data to the RA report. In practice, this is a method to bind the RA report to your application. For example, you can generate a key pair and include the public key. This way, others can verify that the RA report was indeed generated by your program by checking the signature with the public key, after the RA quote itself has been verified.

```python
from dstack_sdk import TappdClient

# Initialize the client
client = TappdClient()

# Get quote for a message
result = client.tdx_quote('user-data')
quote = bytes.fromhex(result.quote)
```

### Access Database

Phala TEE Cloud supports running a database locally or connecting to an external database. There is no difference in how you access a database compared to a general server. To save your data to disk, **you need to [configure volumes](https://docs.docker.com/reference/compose-file/volumes/) in the Docker Compose file** and write data to the correct path, here is an example from Docker website.

```yaml
services:
  backend:
    image: example/database
    volumes:
      - db-data:/etc/data

  backup:
    image: backup-service
    volumes:
      - db-data:/var/lib/backup/data

volumes:
  db-data:
```

### Create Crypto Wallet

You can derive a deterministic key using the [Dstack Guest SDK](https://github.com/Dstack-TEE/dstack/tree/master/sdk) inside Docker. Under the hood, the `TappdClient` derives the key from the application root key.

```python
from dstack_sdk import TappdClient

# Initialize the client
client = TappdClient()

# Derive Key Account by given **derive** **path** and **alt names**
result = await client.derive_key('/', 'alt names')
```
